<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>í”„ë­í¬ ì˜¤ë²„ë ˆì´ (GPS ì´ë™ê±°ë¦¬)</title>
<script src="https://cdn.jsdelivr.net/npm/@rtirl/api"></script>
<style>
Â  html, body {
Â  Â  margin: 0;
Â  Â  padding: 0;
Â  Â  overflow: hidden;
Â  Â  font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
Â  Â  background: transparent;
Â  Â  color: white;
Â  }

Â  /* í•˜ë‹¨ë°” */
Â  #overlay {
Â  Â  position: fixed;
Â  Â  bottom: 0;
Â  Â  width: 100%;
Â  Â  height: 38px;
Â  Â  background: rgba(0, 0, 0, 0.70);
Â  Â  backdrop-filter: blur(5px);
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  gap: 25px;
Â  Â  font-size: 15px;
Â  Â  padding: 0 15px;
Â  Â  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
Â  }

Â  .section {
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  gap: 2px;
Â  Â  white-space: nowrap;
Â  }

Â  /* ë¡œê³  í¬ê¸° */
Â  .icon {
Â  Â  width: 28px !important;
Â  Â  height: auto !important;
Â  Â  opacity: 0.9;
Â  Â  transition: opacity 0.3s ease;
Â  Â  object-fit: contain;
Â  Â  vertical-align: middle;
Â  }
Â  .icon:hover {
Â  Â  opacity: 1;
Â  }

Â  /* ê±°ë¦¬ ê°•ì¡° */
Â  #distance {
Â  Â  font-weight: 600;
Â  Â  color: #00ff88;
Â  Â  text-shadow: 0 0 5px rgba(0, 255, 136, 0.3);
Â  }

Â  /* ìƒíƒœ ë„íŠ¸ */
Â  .status-dot {
Â  Â  width: 8px;
Â  Â  height: 8px;
Â  Â  border-radius: 50%;
Â  Â  background: #4CAF50;
Â  Â  display: inline-block;
Â  Â  margin-right: 4px;
Â  Â  animation: pulse 2s infinite;
Â  }
Â  .status-dot.connecting { background: #FF9800; }
Â  .status-dot.error { background: #F44336; animation: none; }
Â  @keyframes pulse {
Â  Â  0% { opacity: 1; }
Â  Â  50% { opacity: 0.5; }
Â  Â  100% { opacity: 1; }
Â  }

Â  /* ë°˜ì‘í˜• */
Â  @media (max-width: 768px) {
Â  Â  #overlay {
Â  Â  Â  gap: 15px;
Â  Â  Â  font-size: 13px;
Â  Â  }
Â  Â  .icon {
Â  Â  Â  width: 24px !important;
Â  Â  }
Â  Â  .section {
Â  Â  Â  gap: 1px;
Â  Â  }
Â  }
</style>
</head>
<body>
<div id="overlay">
Â  <div class="section" id="distance">
Â  Â  <span class="status-dot connecting"></span>
Â  Â  ì´ë™ê±°ë¦¬: 0.00 km
Â  </div>
Â  <div class="section" id="weather">ë‚ ì”¨: --Â°C</div>
Â  <div class="section" id="time">ì‹œê°„: --:--</div>
Â  <div class="section" id="battery">ë°°í„°ë¦¬: --%</div>

Â  Â  <div class="section">
Â  Â  <img class="icon" src="https://raw.githubusercontent.com/ljw2455qq/obs-overlay/main/%EC%88%B2%EB%A1%9C%EA%B3%A0.png" alt="ìˆ²" title="ìˆ²" />
Â  Â  <img class="icon" src="https://raw.githubusercontent.com/ljw2455qq/obs-overlay/main/%EC%B9%98%EC%A7%80%EC%A7%81%EB%A1%9C%EA%B3%A0.png" alt="ì¹˜ì§€ì§" title="ì¹˜ì§€ì§" />
Â  Â  <img class="icon" src="https://raw.githubusercontent.com/ljw2455qq/obs-overlay/main/%ED%8A%B8%EC%9C%84%EC%B9%98%EB%A1%9C%EA%B3%A0.png" alt="Twitch" title="Twitch" />
Â  Â  <img class="icon" src="https://raw.githubusercontent.com/ljw2455qq/obs-overlay/main/%EC%9C%A0%ED%8A%9C%EB%B8%8C%EB%A1%9C%EA%B3%A0.png" alt="YouTube" title="YouTube" />
Â  </div>
</div>

<script>
/* =========================
Â  Â  ê¸°ë³¸ ì„¤ì •
========================= */
// âš ï¸ ì—¬ê¸°ì— ë³¸ì¸ì˜ RealtimeIRL Pull Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”
const PULL_KEY = "zeoeyze9htbyx455"; 
// âš ï¸ ì—¬ê¸°ì— ë³¸ì¸ì˜ OpenWeatherMap API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„¸ì¢…ì‹œ ë‚ ì”¨ ê¸°ì¤€)
const WEATHER_API = "3a4a39b054762e36581605681026ed35"; 

/* =========================
Â  Â  ì´ë™ê±°ë¦¬ ê³„ì‚° ë³€ìˆ˜
========================= */
let totalDistance = 0;
let previousLocation = null;
let lastUpdateTime = 0;
// GPS ì‹ í˜¸ê°€ 10ë¶„(600,000ms) ë™ì•ˆ ì—†ìœ¼ë©´ ê±°ë¦¬ ë¦¬ì…‹
const GPS_TIMEOUT = 600000; 

// Haversine ê³µì‹ìœ¼ë¡œ ë‘ ì¢Œí‘œ ê°„ ê±°ë¦¬ ê³„ì‚° (ë¯¸í„° ë‹¨ìœ„)
function calculateDistance(lat1, lon1, lat2, lon2) {
Â  const R = 6371e3;
Â  const Ï†1 = lat1 * Math.PI / 180;
Â  const Ï†2 = lat2 * Math.PI / 180;
Â  const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
Â  const Î”Î» = (lon2 - lon1) * Math.PI / 180;
Â  const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
Â  Â  Â  Â  Â  Â  Math.cos(Ï†1) * Math.cos(Ï†2) *
Â  Â  Â  Â  Â  Â  Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
Â  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
Â  return R * c;
}

/* =========================
Â  Â  ìƒíƒœ ë° ê±°ë¦¬ ì—…ë°ì´íŠ¸
========================= */
function updateStatus(status) {
Â  const dot = document.querySelector('.status-dot');
Â  if (dot) {
Â  Â  dot.className = 'status-dot';
Â  Â  if (status) dot.classList.add(status);
Â  }
}

function resetDistance() {
Â  totalDistance = 0;
Â  previousLocation = null;
Â  updateDistanceDisplay();
}

function updateDistanceDisplay() {
Â  const el = document.getElementById('distance');
Â  // dotì„ í¬í•¨í•œ ì „ì²´ HTMLì„ ì—…ë°ì´íŠ¸
Â  el.innerHTML = `<span class="status-dot"></span>ì´ë™ê±°ë¦¬: ${totalDistance.toFixed(2)} km`;
Â  // ì •ìƒ ì—…ë°ì´íŠ¸ ì‹œ ìƒíƒœ ì´ˆê¸°í™”
Â  updateStatus(''); 
}

/* =========================
Â  Â  RealtimeIRL GPS (ê°œì„ ëœ ë¦¬ì…‹ ë¡œì§ ì ìš©)
========================= */
try {
Â  RealtimeIRL.forPullKey(PULL_KEY).addLocationListener((location) => {
Â  Â  const now = Date.now();
Â  Â  
Â  Â  // 1. ìœ íš¨í•œ GPS ì¢Œí‘œê°€ ìˆ˜ì‹ ëœ ê²½ìš°
Â  Â  if (location.latitude && location.longitude) {
Â  Â  Â  
Â  Â  Â  // 10ë¶„ ì´ìƒ ì‹ í˜¸ê°€ ëŠê²¼ë‹¤ê°€ ëŒì•„ì˜¨ ê²½ìš°, ì´ì „ ìœ„ì¹˜ ì •ë³´ëŠ” ë¬´ì‹œí•˜ì—¬ ê±°ë¦¬ í­ì¦ ë°©ì§€
Â  Â  Â  if (lastUpdateTime > 0 && (now - lastUpdateTime) > GPS_TIMEOUT) {
Â  Â  Â  Â  previousLocation = null;
Â  Â  Â  Â  console.log("GPS ì‹ í˜¸ ë³µêµ¬. ì´ì „ ì‹ í˜¸ ëŠê¹€ì´ ê¸¸ì–´ ê±°ë¦¬ ê³„ì‚°ì„ ìœ„í•´ ì´ì „ ìœ„ì¹˜ ì •ë³´ ë¦¬ì…‹.");
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  lastUpdateTime = now; // ìµœì¢… ì—…ë°ì´íŠ¸ ì‹œê°„ ê°±ì‹ 
Â  Â  Â  
Â  Â  Â  if (previousLocation) {
Â  Â  Â  Â  const dist = calculateDistance(
Â  Â  Â  Â  Â  previousLocation.latitude, previousLocation.longitude,
Â  Â  Â  Â  Â  location.latitude, location.longitude
Â  Â  Â  Â  );
Â  Â  Â  Â  totalDistance += dist / 1000;
Â  Â  Â  }
Â  Â  Â  previousLocation = location;
Â  Â  Â  updateDistanceDisplay();
Â  Â  Â  updateStatus(''); // ì •ìƒ ìƒíƒœ
Â  Â  
Â  Â  } else {
Â  Â  Â  // 2. ìœ íš¨í•˜ì§€ ì•Šì€ ì¢Œí‘œ ìˆ˜ì‹  (GPS ì‹ í˜¸ ì•½í™” ë˜ëŠ” ëŠê¹€)
Â  Â  Â  previousLocation = null; // ê±°ë¦¬ ê³„ì‚° ì¼ì‹œ ì •ì§€ (ë‹¤ìŒ ìœ íš¨ ì‹ í˜¸ê¹Œì§€)
Â  Â  Â  updateStatus('error');
Â  Â  Â  document.getElementById('distance').innerHTML = '<span class="status-dot error"></span>ì´ë™ê±°ë¦¬: ì‹ í˜¸ ì•½í•¨';
Â  Â  }
Â  });
Â  updateStatus('connecting');
} catch (e) {
Â  document.getElementById('distance').innerHTML = '<span class="status-dot error"></span>ì´ë™ê±°ë¦¬: ì—°ê²° ì‹¤íŒ¨';
Â  updateStatus('error');
}

/* GPS ì‹ í˜¸ ì²´í¬ ë° ë¦¬ì…‹ íƒ€ì´ë¨¸ */
setInterval(() => {
Â  // ë§ˆì§€ë§‰ ìœ íš¨ ì‹ í˜¸ê°€ 10ë¶„ ì´ìƒ ì§€ë‚¬ëŠ”ì§€ í™•ì¸
Â  if (lastUpdateTime > 0 && (Date.now() - lastUpdateTime) > GPS_TIMEOUT) {
Â  Â  resetDistance(); // totalDistanceì™€ previousLocationì„ 0/nullë¡œ ë¦¬ì…‹
Â  Â  lastUpdateTime = 0; // íƒ€ì„ì•„ì›ƒ í”Œë˜ê·¸ ë¦¬ì…‹
Â  Â  updateStatus('error');
Â  Â  document.getElementById('distance').innerHTML = '<span class="status-dot error"></span>ì´ë™ê±°ë¦¬: GPS ì‹ í˜¸ ì—†ìŒ (ë¦¬ì…‹)';
Â  }
}, 5000); // 5ì´ˆë§ˆë‹¤ ì²´í¬

/* =========================
Â  Â  ë‚ ì”¨ (OpenWeatherMap)
========================= */
async function updateWeather() {
Â  try {
Â  Â  // ì„¸ì¢…ì‹œ ë‚ ì”¨ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. í•„ìš”ì— ë”°ë¼ q=Sejong,KRë¥¼ ë³€ê²½í•˜ì„¸ìš”.
Â  Â  const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Sejong,KR&appid=${WEATHER_API}&units=metric&lang=kr`);
Â  Â  const data = await res.json();
Â  Â  const temp = Math.round(data.main.temp);
Â  Â  const desc = data.weather[0]?.description || '';
Â  Â  document.getElementById("weather").innerHTML = `ë‚ ì”¨: ${temp}Â°C ${desc}`;
Â  } catch (e) {
Â  Â  document.getElementById("weather").innerHTML = "ë‚ ì”¨: --Â°C";
Â  }
}
updateWeather();
setInterval(updateWeather, 600000); // 10ë¶„ë§ˆë‹¤ ì—…ë°ì´íŠ¸

/* =========================
Â  Â  ì‹œê°„
========================= */
function updateTime() {
Â  const now = new Date();
Â  let h = now.getHours();
Â  const m = now.getMinutes().toString().padStart(2, "0");
Â  const ampm = h >= 12 ? "ì˜¤í›„" : "ì˜¤ì „";
Â  h = h % 12 || 12;
Â  document.getElementById("time").innerHTML = `ì‹œê°„: ${ampm} ${h}:${m}`;
}
updateTime();
setInterval(updateTime, 1000);

/* =========================
Â  Â  ë°°í„°ë¦¬ (ë¸Œë¼ìš°ì € ì§€ì› ì‹œ)
========================= */
if (navigator.getBattery) {
Â  navigator.getBattery().then(battery => {
Â  Â  function update() {
Â  Â  Â  const level = Math.round(battery.level * 100);
Â  Â  Â  const icon = battery.charging ? 'âš¡ì¶©ì „ ì¤‘' : 'ğŸ”‹ë°°í„°ë¦¬';
Â  Â  Â  document.getElementById("battery").innerHTML = `${icon}: ${level}%`;
Â  Â  }
Â  Â  battery.addEventListener("levelchange", update);
Â  Â  battery.addEventListener("chargingchange", update);
Â  Â  update();
Â  });
} else {
Â  document.getElementById("battery").innerHTML = "ë°°í„°ë¦¬: N/A";
}

/* ë””ë²„ê¹… ë¡œê·¸ */
setInterval(() => {
Â  const ago = lastUpdateTime > 0 ? Math.floor((Date.now() - lastUpdateTime)/1000) : 0;
Â  console.log(`[ìƒíƒœ] ê±°ë¦¬: ${totalDistance.toFixed(3)}km | ì—…ë°ì´íŠ¸: ${ago}ì´ˆ ì „ | prevLoc: ${previousLocation ? 'O' : 'X'}`);
}, 5000);

console.log('í”„ë­í¬ ì˜¤ë²„ë ˆì´ ì´ˆê¸°í™” ì™„ë£Œ');
</script>
</body>
</html>
