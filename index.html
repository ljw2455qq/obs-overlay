<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>IRL Overlay Final</title>

<!-- RealtimeIRL -->
<script src="https://cdn.jsdelivr.net/npm/@rtirl/api"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>

html, body {
    margin:0;
    padding:0;
    background:transparent;
    overflow:hidden;
    font-family: Pretendard, sans-serif;
}

/* ì „ì²´ ë°” */
#overlay {

    position:fixed;
    bottom:0;
    left:0;
    right:0;

    height:36px;

    background:rgba(0,0,0,0.7);

    backdrop-filter:blur(6px);

    display:flex;
    justify-content:space-between;
    align-items:center;

    padding:0 12px;

    font-size:13px;
    font-weight:400;
    color:#ffffff;

}

/* ì¢Œì¸¡ ê·¸ë£¹ */
.left-group {

    display:flex;
    align-items:center;
    gap:12px;

}

/* ìš°ì¸¡ ê·¸ë£¹ */
.right-group {

    display:flex;
    align-items:center;
    gap:12px;

}

/* í•­ëª© */
.item {

    display:flex;
    align-items:center;
    gap:4px;

}

/* ìˆ˜ìµ ìŠ¤íƒ€ì¼ (ì™„ì „ ë™ì¼) */
.revenue {

    display:flex;
    gap:8px;

}

.revenue span {

    font-size:13px;
    font-weight:400;
    color:#ffffff;

}

/* ê±°ë¦¬ ê°•ì¡° */
#distance {

    color:#7df9ff;

}

</style>
</head>


<body>


<div id="overlay">


<!-- ì¢Œì¸¡ -->
<div class="left-group">


<div class="item">
ğŸ“ <span id="distance">0.00 km</span>
</div>


<div class="revenue">

<span>ì¼ <span id="daily">0ì›</span></span>

<span>ì›” <span id="monthly">0ì›</span></span>

<span>ë…„ <span id="yearly">0ì›</span></span>

</div>


</div>


<!-- ìš°ì¸¡ -->
<div class="right-group">


<div class="item" id="weather">
ğŸŒ¡ï¸ --
</div>


<div class="item" id="time">
ğŸ• --
</div>


<div class="item" id="battery">
ğŸ”‹ --
</div>


</div>


</div>


<script>


/* Firebase ì„¤ì • */

const firebaseConfig = {

apiKey: "ì—¬ê¸°ì— ìƒˆ APIí‚¤",

authDomain: "í”„ë¡œì íŠ¸.firebaseapp.com",

databaseURL: "https://í”„ë¡œì íŠ¸-default-rtdb.firebaseio.com",

projectId: "í”„ë¡œì íŠ¸",

};


firebase.initializeApp(firebaseConfig);

const db = firebase.database();



/* ìˆ˜ìµ ë¶ˆëŸ¬ì˜¤ê¸° */

db.ref("overlayData").on("value", snap => {

const d = snap.val();

if(!d) return;

daily.innerText = format(d.daily);

monthly.innerText = format(d.monthly);

yearly.innerText = format(d.yearly);

});


function format(n){

return Number(n).toLocaleString()+"ì›";

}



/* GPS ê±°ë¦¬ */

let total = 0;

let prev = null;


RealtimeIRL.forPullKey("ì—¬ê¸°ì— PullKey")

.addLocationListener(loc=>{

if(prev){

total += calc(prev, loc);

}

prev = loc;

distance.innerText = (total/1000).toFixed(2)+" km";

});


function calc(a,b){

const R=6371e3;

const dLat=(b.latitude-a.latitude)*Math.PI/180;

const dLon=(b.longitude-a.longitude)*Math.PI/180;

const lat1=a.latitude*Math.PI/180;

const lat2=b.latitude*Math.PI/180;

const x=Math.sin(dLat/2)**2+

Math.cos(lat1)*Math.cos(lat2)*

Math.sin(dLon/2)**2;

return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));

}



/* ì‹œê°„ */

setInterval(()=>{

time.innerText="ğŸ• "+new Date().toLocaleTimeString("ko-KR");

},1000);



/* ë°°í„°ë¦¬ */

navigator.getBattery().then(b=>{

function update(){

battery.innerText=(b.charging?"âš¡":"ğŸ”‹")+" "+Math.round(b.level*100)+"%";

}

update();

b.onlevelchange=update;

});



/* ë‚ ì”¨ */

async function weatherLoad(){

const res = await fetch(

"https://api.openweathermap.org/data/2.5/weather?q=Seoul&appid=ë‚ ì”¨APIí‚¤&units=metric"

);

const data = await res.json();

weather.innerText="ğŸŒ¡ï¸ "+Math.round(data.main.temp)+"Â°C";

}

weatherLoad();

setInterval(weatherLoad,600000);


</script>


</body>
</html>
