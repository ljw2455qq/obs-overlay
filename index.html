<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>í”„ë­í¬ ì˜¤ë²„ë ˆì´ (GPS ì´ë™ê±°ë¦¬)</title>

<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    font-family: "Pretendard", sans-serif;
    background: transparent;
    color: white;
  }

  /* í•˜ë‹¨ë°” */
  #overlay {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 38px;
    background: rgba(0, 0, 0, 0.70);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 25px;
    font-size: 15px;
    padding: 0 15px;
  }

  .section {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .icon {
    height: 20px;
  }
</style>
</head>

<body>

<!-- ğŸ“Œ í•˜ë‹¨ ì˜¤ë²„ë ˆì´ -->
<div id="overlay">

  <div class="section" id="distance">ì´ë™ê±°ë¦¬: 0.0 km</div>
  <div class="section" id="weather">ë‚ ì”¨: --Â°C</div>
  <div class="section" id="time">ì‹œê°„: --:--</div>
  <div class="section" id="battery">ë°°í„°ë¦¬: --%</div>

  <!-- í”Œë«í¼ ë¡œê³  -->
  <div class="section">
    <img class="icon" src="https://upload.wikimedia.org/wikipedia/commons/3/3f/Twitch_logo_2019.svg" />
    <img class="icon" src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" />
    <img class="icon" src="https://cdn-icons-png.flaticon.com/512/3670/3670157.png" />
    <img class="icon" src="https://cdn-icons-png.flaticon.com/512/5968/5968764.png" />
  </div>

</div>


<script src="https://cdn.jsdelivr.net/npm/@rtirl/api@latest/lib/index.min.js"></script>

<script>
/* =========================
    ê¸°ë³¸ ì„¤ì •
========================= */
const PULL_KEY = "zeoeyze9htbyx455";
const WEATHER_API = "3a4a39b054762e36581605681026ed35";

/* =========================
    ì´ë™ê±°ë¦¬ ê³„ì‚° ê´€ë ¨ ë³€ìˆ˜
========================= */
let prevLocation = null;
let totalDistance = 0;
let lastUpdateTime = 0;

/* Haversine ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (km ë‹¨ìœ„) */
function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = ((lat2 - lat1) * Math.PI) / 180;
  const dLon = ((lon2 - lon1) * Math.PI) / 180;
  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(lat1 * Math.PI / 180) *
    Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon / 2) ** 2;

  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

/* =========================
    GPS ê±°ë¦¬ ë¦¬ì…‹ í•¨ìˆ˜
========================= */
function resetDistance() {
  totalDistance = 0;
  prevLocation = null;
  document.getElementById("distance").innerText =
    "ì´ë™ê±°ë¦¬: 0.0 km";
}

/* =========================
    realtimeIRL GPS ìˆ˜ì‹ 
========================= */
RealtimeIRL.forPullKey(PULL_KEY).addLocationListener((loc) => {

  const now = Date.now();

  // GPSê°€ 5ì´ˆ ì´ìƒ ëŠê²¼ë‹¤ê°€ ë‹¤ì‹œ ë“¤ì–´ì˜¤ë©´ ê±°ë¦¬ ë¦¬ì…‹
  if (now - lastUpdateTime > 5000) {
    resetDistance();
  }

  lastUpdateTime = now;

  const { latitude, longitude } = loc;

  // ì´ì „ ì¢Œí‘œê°€ ìˆì„ ë•Œ ì´ë™ ê±°ë¦¬ ê³„ì‚°
  if (prevLocation) {
    const d = haversine(
      prevLocation.latitude,
      prevLocation.longitude,
      latitude,
      longitude
    );

    // ì •ìƒ ë²”ìœ„ë¡œ íŒë‹¨ë˜ëŠ” ì´ë™ë§Œ ë”í•¨ (300m ì´í•˜)
    if (d > 0 && d < 0.3) {
      totalDistance += d;
    }
  }

  prevLocation = { latitude, longitude };

  document.getElementById("distance").innerText =
    "ì´ë™ê±°ë¦¬: " + totalDistance.toFixed(1) + " km";
});


/* =========================
    ë‚ ì”¨ ì—…ë°ì´íŠ¸
========================= */
async function updateWeather() {
  const url =
    "https://api.openweathermap.org/data/2.5/weather?q=Sejong,KR&appid=" +
    WEATHER_API +
    "&units=metric&lang=kr";

  try {
    const res = await fetch(url);
    const data = await res.json();

    document.getElementById("weather").innerText =
      "ë‚ ì”¨: " + Math.round(data.main.temp) + "Â°C";
  } catch (e) {
    document.getElementById("weather").innerText = "ë‚ ì”¨: --Â°C";
  }
}

updateWeather();
setInterval(updateWeather, 600000);


/* =========================
    ì‹œê°„ (ì˜¤ì „/ì˜¤í›„)
========================= */
function updateTime() {
  const now = new Date();
  let hours = now.getHours();
  const minutes = now.getMinutes().toString().padStart(2, "0");
  const ampm = hours >= 12 ? "ì˜¤í›„" : "ì˜¤ì „";
  hours = hours % 12 || 12;

  document.getElementById("time").innerText =
    "ì‹œê°„: " + ampm + " " + hours + ":" + minutes;
}

updateTime();
setInterval(updateTime, 1000);


/* =========================
    ë°°í„°ë¦¬ (ë¸Œë¼ìš°ì €/í° ì§€ì› ê°€ëŠ¥ ì‹œë§Œ)
========================= */
navigator.getBattery?.().then((battery) => {
  function updateBattery() {
    document.getElementById("battery").innerText =
      "ë°°í„°ë¦¬: " + Math.round(battery.level * 100) + "%";
  }
  battery.addEventListener("levelchange", updateBattery);
  updateBattery();
});
</script>

</body>
</html>
